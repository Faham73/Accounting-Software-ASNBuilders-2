// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  ACCOUNTANT
  ENGINEER
  DATA_ENTRY
  VIEWER
}

enum ProjectStatus {
  DRAFT
  RUNNING
  COMPLETED
  CLOSED
}

enum PaymentMethodType {
  CASH
  BANK
  CHEQUE
  MOBILE
}

enum VoucherType {
  RECEIPT
  PAYMENT
  JOURNAL
  CONTRA
}

enum ExpenseType {
  PROJECT_EXPENSE
  OFFICE_EXPENSE
}

enum OverheadAllocationMethod {
  PERCENT
  CONTRACT_VALUE
}

enum VoucherStatus {
  DRAFT
  SUBMITTED
  APPROVED
  POSTED
  REVERSED
}

enum AccountType {
  ASSET
  LIABILITY
  INCOME
  EXPENSE
  EQUITY
}

enum ProjectCostCategory {
  CIVIL
  MATERIALS
  MATI_KATA
  DHALAI
  BROKERAGE
  OTHERS
}

enum ExpenseSource {
  WAREHOUSE
  LABOR
}

enum PurchaseStatus {
  DRAFT
  SUBMITTED
  APPROVED
  POSTED
  REVERSED
}

enum WarehouseType {
  LOCAL
  COMPANY
}

model Company {
  id        String   @id @default(cuid())
  name      String
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  users           User[]
  projects        Project[]
  vendors         Vendor[]
  costHeads                CostHead[]
  paymentMethods           PaymentMethod[]
  attachments              Attachment[]
  accounts                 Account[]
  vouchers                 Voucher[]
  voucherLines             VoucherLine[]
  auditLogs                AuditLog[]
  projectCostCategoryMaps  ProjectCostCategoryMap[]
  overheadAllocationRules  OverheadAllocationRule[]
  overheadAllocationResults OverheadAllocationResult[]
  projectFiles             ProjectFile[]
  products                 Product[]
  warehouses               Warehouse[]
  purchases                Purchase[]
  inventoryTxns           InventoryTxn[]
  productCategories        ProductCategory[]
  expenses                 Expense[]
  expenseCategories        ExpenseCategory[]

  @@map("companies")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  passwordHash String   @map("password_hash")
  role         UserRole
  companyId    String   @map("company_id")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")

  company            Company       @relation(fields: [companyId], references: [id])
  uploadedAttachments Attachment[]
  createdVouchers    Voucher[]     @relation("VoucherCreator")
  submittedVouchers  Voucher[]     @relation("VoucherSubmitter")
  approvedVouchers   Voucher[]     @relation("VoucherApprover")
  postedVouchers     Voucher[]     @relation("VoucherPoster")
  reversedVouchers   Voucher[]     @relation("VoucherReverser")
  auditLogs          AuditLog[]
  createdAllocationRules OverheadAllocationRule[] @relation("AllocationRuleCreator")
  expensesPaidBy Expense[]

  @@index([companyId])
  @@map("users")
}

model Project {
  id              String        @id @default(cuid())
  companyId       String        @map("company_id")
  name            String
  clientName      String?       @map("client_name")
  clientContact   String?       @map("client_contact")
  siteLocation    String?       @map("site_location")
  startDate       DateTime?     @map("start_date")
  expectedEndDate DateTime?     @map("expected_end_date")
  contractValue   Decimal?      @map("contract_value") @db.Decimal(15, 2)
  status          ProjectStatus @default(DRAFT)
  assignedManager String?       @map("assigned_manager")
  isActive        Boolean       @default(true) @map("is_active")
  // New fields
  address         String?       @map("address")
  projectManager  String?       @map("project_manager")
  projectEngineer String?       @map("project_engineer")
  companySiteName String?       @map("company_site_name")
  reference       String?       @map("reference")
  isMain          Boolean       @default(false) @map("is_main")
  parentProjectId String?       @map("parent_project_id")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  company         Company       @relation(fields: [companyId], references: [id])
  vouchers        Voucher[]
  voucherLines    VoucherLine[]
  overheadAllocations OverheadAllocationResult[]
  files           ProjectFile[]
  parentProject   Project?      @relation("ProjectHierarchy", fields: [parentProjectId], references: [id])
  subProjects     Project[]     @relation("ProjectHierarchy")
  mainPurchases   Purchase[]    @relation("PurchaseMainProject")
  subPurchases    Purchase[]    @relation("PurchaseSubProject")
  inventoryTxns   InventoryTxn[]
  expenses        Expense[]
  mainProjectExpenses Expense[] @relation("MainProjectForExpense")

  @@index([companyId])
  @@index([parentProjectId])
  @@index([companyId, parentProjectId])
  @@map("projects")
}

model Vendor {
  id        String   @id @default(cuid())
  companyId String   @map("company_id")
  name      String
  phone     String?
  address   String?
  notes     String?
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company      Company      @relation(fields: [companyId], references: [id])
  voucherLines VoucherLine[]
  purchases    Purchase[]
  expenses     Expense[]

  @@index([companyId])
  @@map("vendors")
}

model CostHead {
  id        String   @id @default(cuid())
  companyId String   @map("company_id")
  name      String
  code      String?
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company                  Company                  @relation(fields: [companyId], references: [id])
  voucherLines             VoucherLine[]
  projectCostCategoryMaps  ProjectCostCategoryMap[]

  @@unique([companyId, name])
  @@index([companyId])
  @@map("cost_heads")
}

model PaymentMethod {
  id        String            @id @default(cuid())
  companyId String            @map("company_id")
  name      String
  type      PaymentMethodType
  isActive  Boolean           @default(true) @map("is_active")
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")

  company       Company       @relation(fields: [companyId], references: [id])
  voucherLines  VoucherLine[]
  expenses      Expense[]

  @@unique([companyId, name])
  @@index([companyId])
  @@map("payment_methods")
}

model Attachment {
  id              String   @id @default(cuid())
  companyId       String   @map("company_id")
  uploadedByUserId String  @map("uploaded_by_user_id")
  url             String
  fileName        String   @map("file_name")
  mimeType        String   @map("mime_type")
  sizeBytes       Int      @map("size_bytes")
  createdAt       DateTime @default(now()) @map("created_at")

  company    Company @relation(fields: [companyId], references: [id])
  uploadedBy User    @relation(fields: [uploadedByUserId], references: [id])

  @@index([companyId])
  @@index([uploadedByUserId])
  @@map("attachments")
}

model Account {
  id        String      @id @default(cuid())
  companyId String      @map("company_id")
  code      String
  name      String
  type      AccountType
  parentId  String?     @map("parent_id")
  isActive  Boolean     @default(true) @map("is_active")
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")

  company      Company       @relation(fields: [companyId], references: [id])
  parent       Account?      @relation("AccountHierarchy", fields: [parentId], references: [id])
  children     Account[]     @relation("AccountHierarchy")
  voucherLines VoucherLine[]
  purchasePayments Purchase[] @relation("PurchasePaymentAccount")
  productInventoryAccounts Product[] @relation("ProductInventoryAccount")
  expenseDebitAccounts Expense[] @relation("ExpenseDebitAccount")
  expenseCreditAccounts Expense[] @relation("ExpenseCreditAccount")

  @@unique([companyId, code])
  @@unique([companyId, name])
  @@index([companyId])
  @@index([parentId])
  @@map("accounts")
}

model Voucher {
  id              String        @id @default(cuid())
  companyId       String        @map("company_id")
  projectId       String?       @map("project_id")
  voucherNo       String        @map("voucher_no")
  type            VoucherType?  @default(JOURNAL)
  expenseType     ExpenseType?  @map("expense_type")
  date            DateTime
  status          VoucherStatus @default(DRAFT)
  narration       String?
  createdByUserId String        @map("created_by_user_id")
  
  // Workflow fields
  submittedAt     DateTime?     @map("submitted_at")
  submittedById   String?       @map("submitted_by_id")
  approvedAt      DateTime?     @map("approved_at")
  approvedById    String?       @map("approved_by_id")
  postedByUserId  String?       @map("posted_by_user_id")
  postedAt        DateTime?     @map("posted_at")
  
  // Reversal fields
  reversalOfId    String?       @map("reversal_of_id")
  reversedById    String?       @map("reversed_by_id")
  reversedAt      DateTime?     @map("reversed_at")
  
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  company         Company            @relation(fields: [companyId], references: [id])
  project         Project?           @relation(fields: [projectId], references: [id])
  createdBy       User               @relation("VoucherCreator", fields: [createdByUserId], references: [id])
  submittedBy     User?              @relation("VoucherSubmitter", fields: [submittedById], references: [id])
  approvedBy      User?              @relation("VoucherApprover", fields: [approvedById], references: [id])
  postedBy        User?              @relation("VoucherPoster", fields: [postedByUserId], references: [id])
  reversedBy      User?              @relation("VoucherReverser", fields: [reversedById], references: [id])
  originalVoucher Voucher?          @relation("VoucherReversal", fields: [reversalOfId], references: [id])
  reversalVouchers Voucher[]         @relation("VoucherReversal")
  purchase        Purchase?          @relation("PurchaseVoucher")
  expense         Expense?           @relation("ExpenseVoucher")
  lines           VoucherLine[]
  allocations     VendorAllocation[] @relation("PaymentVoucher")

  @@unique([companyId, voucherNo])
  @@index([companyId, date])
  @@index([companyId, status])
  @@index([companyId, type])
  @@index([companyId, expenseType])
  @@index([reversalOfId])
  @@index([companyId, status, date])
  @@map("vouchers")
}

model VoucherLine {
  id             String   @id @default(cuid())
  voucherId      String   @map("voucher_id")
  companyId      String   @map("company_id")
  accountId      String   @map("account_id")
  description    String?
  debit          Decimal  @default(0) @db.Decimal(18, 2)
  credit         Decimal  @default(0) @db.Decimal(18, 2)
  projectId      String?  @map("project_id")
  vendorId       String?  @map("vendor_id")
  costHeadId     String?  @map("cost_head_id")
  paymentMethodId String? @map("payment_method_id")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  voucher          Voucher            @relation(fields: [voucherId], references: [id], onDelete: Cascade)
  company          Company            @relation(fields: [companyId], references: [id])
  account          Account            @relation(fields: [accountId], references: [id])
  project          Project?           @relation(fields: [projectId], references: [id])
  vendor           Vendor?            @relation(fields: [vendorId], references: [id])
  costHead         CostHead?          @relation(fields: [costHeadId], references: [id])
  paymentMethod    PaymentMethod?     @relation(fields: [paymentMethodId], references: [id])
  sourceAllocations VendorAllocation[] @relation("SourceLine")

  @@index([voucherId])
  @@index([companyId])
  @@index([accountId])
  @@index([vendorId])
  @@index([companyId, projectId])
  @@index([companyId, projectId, voucherId])
  @@index([companyId, vendorId])
  @@map("voucher_lines")
}

model ProjectCostCategoryMap {
  id        String             @id @default(cuid())
  companyId String             @map("company_id")
  costHeadId String            @map("cost_head_id")
  category  ProjectCostCategory
  isActive  Boolean            @default(true) @map("is_active")
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")

  company  Company  @relation(fields: [companyId], references: [id])
  costHead CostHead @relation(fields: [costHeadId], references: [id])

  @@unique([companyId, costHeadId])
  @@index([companyId])
  @@index([companyId, category])
  @@map("project_cost_category_maps")
}

model VendorAllocation {
  id               String   @id @default(cuid())
  paymentVoucherId String   @map("payment_voucher_id")
  sourceLineId     String   @map("source_line_id")
  amount           Decimal  @db.Decimal(18, 2)
  createdAt        DateTime @default(now()) @map("created_at")

  paymentVoucher Voucher     @relation("PaymentVoucher", fields: [paymentVoucherId], references: [id], onDelete: Cascade)
  sourceLine     VoucherLine @relation("SourceLine", fields: [sourceLineId], references: [id], onDelete: Cascade)

  @@index([paymentVoucherId])
  @@index([sourceLineId])
  @@map("vendor_allocations")
}

model AuditLog {
  id          String   @id @default(cuid())
  companyId   String   @map("company_id")
  entityType  String   @map("entity_type")
  entityId    String   @map("entity_id")
  action      String
  actorUserId String   @map("actor_user_id")
  before      Json?
  after       Json?
  diffJson    Json?    @map("diff_json")
  metaJson    Json?    @map("meta_json")
  createdAt   DateTime @default(now()) @map("created_at")

  company Company @relation(fields: [companyId], references: [id])
  actor   User    @relation(fields: [actorUserId], references: [id])

  @@index([companyId, entityType, entityId])
  @@index([actorUserId])
  @@map("audit_logs")
}

model OverheadAllocationRule {
  id          String                    @id @default(cuid())
  companyId   String                    @map("company_id")
  month       DateTime                  @db.Date
  method      OverheadAllocationMethod
  allocations Json?                     // For PERCENT method: { projectId: percent }
  createdById String                    @map("created_by_id")
  createdAt   DateTime                  @default(now()) @map("created_at")
  updatedAt   DateTime                  @updatedAt @map("updated_at")

  company    Company                    @relation(fields: [companyId], references: [id])
  createdBy  User                       @relation("AllocationRuleCreator", fields: [createdById], references: [id])
  results    OverheadAllocationResult[]

  @@unique([companyId, month])
  @@index([companyId, month])
  @@map("overhead_allocation_rules")
}

model OverheadAllocationResult {
  id          String   @id @default(cuid())
  ruleId      String   @map("rule_id")
  companyId   String   @map("company_id")
  projectId   String   @map("project_id")
  amount      Decimal  @db.Decimal(18, 2)
  method      OverheadAllocationMethod
  sourceOverheadTotal Decimal @map("source_overhead_total") @db.Decimal(18, 2)
  createdAt   DateTime @default(now()) @map("created_at")

  rule    OverheadAllocationRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)
  company Company                @relation(fields: [companyId], references: [id])
  project Project                @relation(fields: [projectId], references: [id])

  @@index([ruleId])
  @@index([companyId, projectId])
  @@index([companyId, projectId, createdAt])
  @@map("overhead_allocation_results")
}

model ProjectFile {
  id        String   @id @default(cuid())
  companyId String   @map("company_id")
  projectId String   @map("project_id")
  filename  String
  url       String
  mimeType  String   @map("mime_type")
  size      Int
  createdAt DateTime @default(now()) @map("created_at")

  company Company @relation(fields: [companyId], references: [id])
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([projectId])
  @@index([companyId, projectId])
  @@map("project_files")
}

model ProductCategory {
  id        String   @id @default(cuid())
  companyId String   @map("company_id")
  name      String
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company  Company  @relation(fields: [companyId], references: [id])
  products Product[]

  @@unique([companyId, name])
  @@index([companyId])
  @@map("product_categories")
}

model Product {
  id                    String   @id @default(cuid())
  companyId             String   @map("company_id")
  code                  String
  name                  String
  unit                  String
  categoryId            String?  @map("category_id")
  defaultPurchasePrice  Decimal  @default(0) @map("default_purchase_price") @db.Decimal(18, 2)
  defaultSalePrice      Decimal  @default(0) @map("default_sale_price") @db.Decimal(18, 2)
  imageUrl              String?  @map("image_url")
  isInventory           Boolean  @default(true) @map("is_inventory")
  openingStockQty       Decimal  @default(0) @map("opening_stock_qty") @db.Decimal(18, 3)
  openingStockUnitCost  Decimal  @default(0) @map("opening_stock_unit_cost") @db.Decimal(18, 2)
  inventoryAccountId    String?  @map("inventory_account_id")
  isActive              Boolean  @default(true) @map("is_active")
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  company          Company         @relation(fields: [companyId], references: [id])
  category         ProductCategory? @relation(fields: [categoryId], references: [id])
  inventoryAccount Account?        @relation("ProductInventoryAccount", fields: [inventoryAccountId], references: [id])
  purchaseLines    PurchaseLine[]
  inventoryTxns    InventoryTxn[]

  @@unique([companyId, code])
  @@unique([companyId, name])
  @@index([companyId])
  @@index([companyId, categoryId])
  @@index([inventoryAccountId])
  @@map("products")
}

model Warehouse {
  id        String        @id @default(cuid())
  companyId String        @map("company_id")
  name      String
  type      WarehouseType
  isActive  Boolean       @default(true) @map("is_active")
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")

  company   Company    @relation(fields: [companyId], references: [id])
  purchases Purchase[]
  inventoryTxns InventoryTxn[]

  @@unique([companyId, name])
  @@index([companyId])
  @@map("warehouses")
}

model Purchase {
  id              String        @id @default(cuid())
  companyId       String        @map("company_id")
  date            DateTime
  challanNo       String?       @map("challan_no")
  projectId       String        @map("project_id")
  subProjectId    String?       @map("sub_project_id")
  supplierVendorId String       @map("supplier_vendor_id")
  warehouseId     String        @map("warehouse_id")
  reference       String?
  discountPercent Decimal?      @map("discount_percent") @db.Decimal(5, 2)
  subtotal        Decimal       @db.Decimal(18, 2)
  total           Decimal       @db.Decimal(18, 2)
  paidAmount      Decimal       @default(0) @map("paid_amount") @db.Decimal(18, 2)
  dueAmount       Decimal       @default(0) @map("due_amount") @db.Decimal(18, 2)
  paymentAccountId String?      @map("payment_account_id")
  voucherId       String?       @unique @map("voucher_id")
  status          PurchaseStatus @default(DRAFT)
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  company         Company       @relation(fields: [companyId], references: [id])
  project         Project       @relation("PurchaseMainProject", fields: [projectId], references: [id])
  subProject      Project?      @relation("PurchaseSubProject", fields: [subProjectId], references: [id])
  supplierVendor  Vendor        @relation(fields: [supplierVendorId], references: [id])
  warehouse       Warehouse     @relation(fields: [warehouseId], references: [id])
  paymentAccount  Account?      @relation("PurchasePaymentAccount", fields: [paymentAccountId], references: [id])
  voucher         Voucher?      @relation("PurchaseVoucher", fields: [voucherId], references: [id])
  lines           PurchaseLine[]
  attachments     PurchaseAttachment[]
  inventoryTxns   InventoryTxn[]

  @@index([companyId])
  @@index([companyId, date])
  @@index([challanNo])
  @@index([companyId, projectId])
  @@index([companyId, supplierVendorId])
  @@index([voucherId])
  @@index([companyId, status])
  @@map("purchases")
}

model PurchaseLine {
  id         String   @id @default(cuid())
  purchaseId String   @map("purchase_id")
  productId  String   @map("product_id")
  quantity   Decimal  @db.Decimal(18, 3)
  unitPrice  Decimal  @map("unit_price") @db.Decimal(18, 2)
  lineTotal  Decimal  @map("line_total") @db.Decimal(18, 2)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  purchase Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id])

  @@index([purchaseId])
  @@index([productId])
  @@map("purchase_lines")
}

model PurchaseAttachment {
  id         String   @id @default(cuid())
  purchaseId String   @map("purchase_id")
  fileName   String   @map("file_name")
  fileUrl    String   @map("file_url")
  mimeType   String   @map("mime_type")
  sizeBytes  Int      @map("size_bytes")
  uploadedAt DateTime @default(now()) @map("uploaded_at")

  purchase Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)

  @@index([purchaseId])
  @@map("purchase_attachments")
}

model InventoryTxn {
  id         String   @id @default(cuid())
  companyId String   @map("company_id")
  productId String   @map("product_id")
  purchaseId String? @map("purchase_id")
  projectId  String? @map("project_id")
  warehouseId String? @map("warehouse_id")
  qtyIn      Decimal  @default(0) @map("qty_in") @db.Decimal(18, 3)
  qtyOut     Decimal  @default(0) @map("qty_out") @db.Decimal(18, 3)
  unitCost   Decimal  @map("unit_cost") @db.Decimal(18, 2)
  totalCost  Decimal  @map("total_cost") @db.Decimal(18, 2)
  txnDate    DateTime @map("txn_date")
  createdAt  DateTime @default(now()) @map("created_at")

  company   Company   @relation(fields: [companyId], references: [id])
  product   Product   @relation(fields: [productId], references: [id])
  purchase  Purchase? @relation(fields: [purchaseId], references: [id], onDelete: SetNull)
  project   Project?  @relation(fields: [projectId], references: [id])
  warehouse Warehouse? @relation(fields: [warehouseId], references: [id])

  @@index([companyId])
  @@index([companyId, productId])
  @@index([companyId, purchaseId])
  @@index([companyId, projectId])
  @@index([companyId, warehouseId])
  @@index([txnDate])
  @@map("inventory_txns")
}

model ExpenseCategory {
  id        String   @id @default(cuid())
  companyId String   @map("company_id")
  company   Company  @relation(fields: [companyId], references: [id])
  name      String
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  expenses Expense[]

  @@unique([companyId, name])
  @@index([companyId])
  @@map("expense_categories")
}

model Expense {
  id              String         @id @default(cuid())
  companyId       String         @map("company_id")
  company         Company        @relation(fields: [companyId], references: [id])
  projectId       String         @map("project_id")
  project         Project        @relation(fields: [projectId], references: [id])
  mainProjectId   String         @map("main_project_id")
  mainProject     Project        @relation("MainProjectForExpense", fields: [mainProjectId], references: [id])
  date            DateTime
  categoryId      String         @map("category_id")
  category        ExpenseCategory @relation(fields: [categoryId], references: [id])
  source          ExpenseSource
  amount          Decimal        @db.Decimal(14, 2)
  paidByUserId    String         @map("paid_by_user_id")
  paidByUser      User           @relation(fields: [paidByUserId], references: [id])
  paidTo          String?        @map("paid_to")
  vendorId        String?        @map("vendor_id")
  vendor          Vendor?        @relation(fields: [vendorId], references: [id])
  paymentMethodId String         @map("payment_method_id")
  paymentMethod   PaymentMethod  @relation(fields: [paymentMethodId], references: [id])
  debitAccountId  String         @map("debit_account_id")
  debitAccount    Account        @relation("ExpenseDebitAccount", fields: [debitAccountId], references: [id])
  creditAccountId String         @map("credit_account_id")
  creditAccount   Account        @relation("ExpenseCreditAccount", fields: [creditAccountId], references: [id])
  voucherId       String         @unique @map("voucher_id")
  voucher         Voucher        @relation("ExpenseVoucher", fields: [voucherId], references: [id])
  notes           String?
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  @@index([companyId, mainProjectId, date])
  @@index([companyId, projectId, date])
  @@index([companyId, categoryId, date])
  @@index([companyId, mainProjectId])
  @@map("expenses")
}
